= Automatiser avec  Ansible
:author: Antoine Méausoone
:email: meausoone.a@sfeir.com
:twitter: https://twitter.com/AMeausoone
:backend: revealjs
:revealjsdir: https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.4.1/
:revealjs_history: true
:imagesdir: images
// :source-highlighter: pygments
// :revealjs_theme: sky


// ME
// Comment gérer une infra ? Shell  ?
// provissioning , pka Ansible ?
// Ansible : historique, comment ça marche ?, installation
// Inventory : comment ça marche
// ad hoc command : ping, setup, service, test si un package est installé.
// handson 1 : ansible ad hoc
// playbook : comment écrire un playbook, modules
// handson 2 : compléter un playbook
// playbook : les roles, concept organisation
// handson 3 : compléter un role
// ansible-galaxy
// handson 4 : un role avec galaxy
// ansible / Jenkins
// ansible / Docker
//

== /Me

*  {author}
*  2 enfants
*  Ingénieur logiciel, Ex-Atos Worldline, Ex-Capgemini, Sfeir \o/
*  Dev, Ops ... DevOps?

== Problèmes ?

// [%notitle]
== Comment gérer tous ces serveurs aujourd'hui ?

image::server-rack.jpg[background, size=cover]

== Comment ?

[%step]
* Accélérer les déploiements ?
* Fiabiliser les environnements ?
* Faciliter la gestion des serveurs ?
* Automatiser les tâches récurrentes ?

== Let's code this !

image::letscodethis.jpg[background, size=cover]

== Scripts shell ?

[%step]
* Pas "Idempotent"
* Pas robuste
* Maintenabilité ?

== La Solution ?

== Provisionning

image::logo-chef.png[Chef,200,200,float="left",align="center"]
image::logo-puppet.png[Puppet,200,200,float="left",align="center"]
image::logo-salt.png[Salt,200,200,float="right",align="center"]
image::logo-ansible.png[Ansible,200,200,float="right",align="center"]

== Pourquoi Ansible ?

[%step]
* Pas d’agents, pas de master
* Configuration en YAML
* S’installe avec un simple package
* Très simple à apprendre et à utiliser
* Des centaines de modules (+ de 600 aujourd'hui)

== Historique

* Créé en 2012 par link:https://www.linkedin.com/in/michaeldehaan/[Michael DeHaan] pour créer un outil simple par rapport aux concurrents Chef et Puppet
* Racheté par RedHat en 2015

[background-iframe="trends-google.html"]
== Trends

== Comment ça marche ?

image::shema-ssh-ansible.png[ssh]

// TODO Schéma ssh python

== Installation

sudo pip install *ansible*

== Commandes principales

* *ansible* <host-pattern> [options]
* *ansible-playbook* playbook.yml [options]

== Commandes secondaires

* *ansible-galaxy* [delete|import|info|init|install|list|login|remove|search|setup] [--help] [options]
* *ansible-vault* [create|decrypt|edit|encrypt|rekey|view] [--help] [options] vaultfile.yml

== Concepts

* Inventory
* Playbooks
* Modules
* Roles

== Inventory

[source,Ini]
----
[myenvironment:children]
front
middle
backend

[front]
front1
front2

[middle]
middle1
middle2

[backend]
backend
----


== Modules

== Playbooks

== Roles

[%step]
* Organiser son playbook
* Basé sur des conventions (tasks, handlers, vars …)
* Réutilisable !!
* Un role => un groupe de machine
** Ex: rôle « apache_httpd » => serveurs « front »

== Roles | Organisation

== Variables

[source,yaml]
.httpd/vars/main.yml
----
httpd_version: 2.3
----

[source,yaml]
.httpd/tasks/main.yml
----
- name: Ensure httpd is installed
  yum: name= "httpd"
            state= present
            version= {{ httpd_version }}
----

== Tasks

Tasks

== Templates

== Handlers

== Ansible-galaxy

== Ansible & exécution

== Jenkins | configuration d'un job

== Jenkins

* Déclencher un build à partir d’un événement (appel rest, poll scm)
* Lancer un playbook à partir d’une UI
* Historiser les exécutions
* Intégrer un déploiement Ansible dans un pipeline Jenkins

== Ansible | Container

* Ansible-container (beta)
** Contruit des containers docker à partir de playbook Ansible
** Déployer ces containers dans le cloud
** Piloter ces containers

== Questions ?

== Merci
